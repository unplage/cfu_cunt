<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>èŒè½è®¡æ•°åŠ©æ‰‹ï¼ˆå¼ºå“åº”ç‰ˆï¼‰</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background:#f8fafc; }
    button { padding:10px 16px; margin:5px; background:#1d4ed8; color:white; border:none; border-radius:4px; cursor:pointer; }
    button:hover { background:#1e40af; }
    canvas { display:block; margin:15px 0; border:1px #ddd solid; background:#fff; }
    #log { background:#eef; padding:10px; border-radius:4px; font-family:monospace; font-size:0.9em; white-space:pre-wrap; }
  </style>
</head>
<body>
  <h1>ğŸ”¬ èŒè½è®¡æ•°åŠ©æ‰‹ï¼ˆå¼ºå“åº”ç‰ˆï¼‰</h1>
  <p>âœ… ç‚¹å‡»æŒ‰é’®å¿…æœ‰åé¦ˆï½œâœ… èŒè½ä¸­å¿ƒæ ‡è“ç‚¹ï½œâœ… é€‚é…ä»»æ„å¹³æ¿</p>

  <div>
    <button id="btn-capture">ğŸ“¸ å°è¯•å¯åŠ¨ç›¸æœºï¼ˆå¯èƒ½è¢«æµè§ˆå™¨é˜»æ­¢ï¼‰</button>
    <button id="btn-upload">ğŸ“¤ ä¸Šä¼ å›¾åƒï¼ˆå¿…å“åº”ï¼‰</button>
    <button id="btn-test">ğŸ§ª å¼ºåˆ¶æµ‹è¯•ï¼ˆç”»5ä¸ªèŒè½ï¼‰</button>
  </div>

  <canvas id="canvas-out" width="600" height="400"></canvas>
  <div><strong>æ—¥å¿—ï¼š</strong><div id="log">ç­‰å¾…æ“ä½œ...</div></div>

  <script>
    const canvas = document.getElementById('canvas-out');
    const ctx = canvas.getContext('2d');
    const logEl = document.getElementById('log');

    function log(msg) {
      logEl.textContent = `[${new Date().toLocaleTimeString()}] ${msg}\n${logEl.textContent}`;
    }

    // âœ… å¼ºåˆ¶æµ‹è¯•ï¼šç”»5ä¸ªèŒè½ + è“ç‚¹
    document.getElementById('btn-test').onclick = () => {
      log('âœ… è§¦å‘æµ‹è¯•ï¼šç»˜åˆ¶5ä¸ªæ¨¡æ‹ŸèŒè½');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#fff';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      const centers = [[100,120], [250,180], [400,100], [150,300], [350,320]];
      // ç”»èŒè½ï¼ˆé»‘åœ†ï¼‰
      ctx.fillStyle = '#000';
      centers.forEach(([x,y]) => {
        ctx.beginPath();
        ctx.arc(x, y, 20, 0, Math.PI*2);
        ctx.fill();
      });
      // ğŸ”µ æ ‡ä¸­å¿ƒè“ç‚¹
      ctx.fillStyle = 'rgba(30,144,255,0.9)';
      ctx.strokeStyle = '#fff';
      ctx.lineWidth = 1;
      centers.forEach(([x,y]) => {
        ctx.beginPath();
        ctx.arc(x, y, 3, 0, Math.PI*2);
        ctx.fill();
        ctx.stroke();
      });
      log(`âœ… å·²æ ‡è®° ${centers.length} ä¸ªèŒè½ä¸­å¿ƒï¼ˆè“è‰²å°ç‚¹ï¼‰`);
    };

    // âœ… ä¸Šä¼ æŒ‰é’®ï¼šå¿…å“åº”
    document.getElementById('btn-upload').onclick = () => {
      log('ğŸ“¤ ç‚¹å‡»ä¸Šä¼ æŒ‰é’® â†’ è§¦å‘æ–‡ä»¶é€‰æ‹©å™¨');
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = (e) => {
        if (!e.target.files[0]) return;
        log('ğŸ“„ æ­£åœ¨è¯»å–å›¾åƒ...');
        const reader = new FileReader();
        reader.onload = (ev) => {
          const img = new Image();
          img.onload = () => {
            log('ğŸ–¼ï¸ å›¾åƒåŠ è½½å®Œæˆï¼Œå‡†å¤‡æ ‡è®°...');
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(img, 0, 0);

            // æ¨¡æ‹Ÿæ£€æµ‹ï¼šå– 3 ä¸ªéšæœºä½ç½®ä½œä¸ºâ€œèŒè½ä¸­å¿ƒâ€
            const w = canvas.width, h = canvas.height;
            const centers = [
              [w * 0.3, h * 0.4],
              [w * 0.6, h * 0.5],
              [w * 0.4, h * 0.7]
            ];

            // ğŸ”µ ç”»è“ç‚¹
            ctx.fillStyle = 'rgba(30,144,255,0.9)';
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 1;
            centers.forEach(([x,y]) => {
              ctx.beginPath();
              ctx.arc(x, y, 3, 0, Math.PI*2);
              ctx.fill();
              ctx.stroke();
            });
            log(`âœ… æ£€æµ‹åˆ° 3 ä¸ªèŒè½ï¼ˆç¤ºä¾‹ï¼‰ï¼Œä¸­å¿ƒå·²æ ‡è“ç‚¹`);
          };
          img.src = ev.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
      };
      input.click();
    };

    // âœ… æ‹ç…§æŒ‰é’®ï¼šå³ä½¿å¤±è´¥ä¹Ÿæç¤º
    document.getElementById('btn-capture').onclick = () => {
      log('ğŸ“· å°è¯•å¯åŠ¨ç›¸æœº...');
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        log('âŒ æµè§ˆå™¨ä¸æ”¯æŒ navigator.mediaDevices');
        return;
      }

      navigator.mediaDevices.getUserMedia({ video: { width: 640, height: 480 } })
        .then(stream => {
          log('âœ… ç›¸æœºæµè·å–æˆåŠŸï¼ˆä½†æœªæ˜¾ç¤ºï¼Œä»…æµ‹è¯•å“åº”ï¼‰');
          // å®é™…é¡¹ç›®ä¸­å¯åœ¨æ­¤åˆ›å»º video å…ƒç´ 
          const video = document.createElement('video');
          video.srcObject = stream;
          video.play();
          setTimeout(() => {
            stream.getTracks().forEach(track => track.stop());
            log('â¹ï¸ ç›¸æœºæµå·²å…³é—­ï¼ˆæµ‹è¯•ç»“æŸï¼‰');
          }, 3000);
        })
        .catch(err => {
          log(`âŒ ç›¸æœºå¯åŠ¨å¤±è´¥ï¼š${err.name} - ${err.message}`);
          log('âš ï¸ å¸¸è§åŸå› ï¼š1) é HTTPS ç¯å¢ƒ 2) æœ¬åœ° file:// åè®® 3) æƒé™è¢«æ‹’');
          log('ğŸ‘‰ è¯·æ”¹ç”¨ã€ä¸Šä¼ ã€‘æŒ‰é’®ï¼Œæˆ–éƒ¨ç½²åˆ° GitHub Pages / localhost');
        });
    };
  </script>
</body>
</html>
